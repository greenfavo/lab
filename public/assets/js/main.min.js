$(document).ready(function(){function e(e){$(".unLogin").hide(),$(".logined").show(),$("#username").text(e.username)}function t(e,t){return e.length>t&&(e=e.substr(0,t)+"..."),e}"?login=false"===window.location.search&&$("#loginModal").modal({keyboard:!0}),$("#check").click(function(){$(this).attr("checked")?$(this).removeAttr("checked"):$(this).attr("checked","checked")}),$(".hotpost_title").each(function(e,o){var a=t($(this).text(),17);$(this).text(a)}),$(".avatar").each(function(e,t){var o=$(this).text()[0].toUpperCase();$(this).text(o)}),$.ajax({url:"/login/username",type:"get",success:function(t){"logined"===t.signal?e(t):console.log("未登录")},error:function(){console.log("发生错误")}}),$("#loginbtn").click(function(e){e.preventDefault(),"登录"===$(this).text()&&$("#loginModal").modal({keyboard:!0})}),$("#loginSubmit").click(function(){var t=$("#user").val(),o=$("#password").val(),a=$("#check").attr("checked"),n=$(this);$.ajax({url:"/login",type:"POST",data:{username:t,password:o,checked:a},beforeSend:function(){n.attr("disabled","disabled").val("加载中...")},success:function(t){n.removeAttr("disabled").val("提交"),"success"===t.signal?($("#loginModal").modal("hide"),e(t)):($(".msg").text(t.signal).show(),$("#user,#password").val(""))},error:function(){alert("发生错误")}})}),$("#out").click(function(){$.get("/login/out",function(e){"out"===e.signal&&(console.log("已退出"),$(".unLogin").show(),$(".logined").hide())})}),$("#commentBtn").click(function(){var e=$("#name").val(),t=$("#email").val(),o=$("#content").val(),a=$("#postid").val();o?$.post("/handleComments",{name:e,email:t,content:o,postid:a},function(e){"error"==e.signal?alert("发生错误"):"success"==e.signal?alert("你的评论已提交成功，正在审核中..."):alert("提交失败")}):alert("请填写评论内容")});var o={regForm:function(){$("#regModal").modal({keyboard:!0})},validate:function(){var e=$(".msg"),t=/^([a-z0-9]){6,}/i,o=/^([a-z0-9\_\-])+\@(([a-z0-9\_\-])+\.)+([a-z]{2,4})+$/i,a=/^1\d{10}$/;$("#regpassword").blur(function(){t.test($(this).val())?e.hide():(e.show().text("密码至少6位，只能是数字字母下划线"),$(this).focus())}),$("#email").blur(function(t){o.test($(this).val())?e.hide():(e.show().text("邮箱格式错误，正确的格式为:tom12@163.com"),$(this).focus())}),$("#phone").blur(function(){$(this).val()&&(a.test($(this).val())?(validated=1,e.hide()):(validated=0,$(this).focus(),e.show().text("手机号码格式错误,请填写11位手机号")))})},handleReg:function(){var e=$("#regname").val(),t=$("#trueName").val(),o=$("#regpassword").val(),a=$("#group").val(),n=$("#email").val(),i=$("#phone").val(),l=$(".msg");e&&t&&o&&a&&n?($("#regSubmit").removeAttr("disabled"),$.ajax({url:"/register",type:"POST",data:{username:e,trueName:t,password:o,group:a,email:n,phone:i},success:function(e){l.show(),"success"===e.signal?(l.text("提交成功，注册信息正在审核中..."),setTimeout(function(){$("#regModal").modal("hide")},1e3)):"用户名已存在"===e.signal?l.text("用户名被占用"):l.text("出错了！")},error:function(){console.log("请求错误")}})):($("#regSubmit").attr("disabled","disabled"),l.text("*为必填项,请填写完整信息"))}};$("#regbtn").click(o.regForm),o.validate(),$("#regSubmit").click(o.handleReg)}),$(function(){$.ajax({url:"/recentComments",type:"get",success:function(e){var t=e.comments,o=e.articles,a="";for(var n in t)for(var i in o)t[n].articleId==o[i]._id&&(a+="<li>"+t[n].time+"  "+t[n].name,a+="在<a href='/article/"+o[i]._id+"'>《"+o[i].title+"》中说:</a>",a+=t[n].content+"</li>");$(".recentComments").append(a)},error:function(e){console.log("近期评论发生错误")}})}),$(function(){$("#team").fullpage({sectionsColor:["#3AB5F3","#1ECF90","#68E6D0","#5E3BE8"],navigationColor:"#2FCDA8",navigation:!0,navigationColor:"#2AEB88",loopBottom:!0,anchors:["1","2","3","4"],menu:!0,fixedElements:"header,footer"})});