$(document).ready(function(){function e(e){$(".unLogin").hide(),$(".logined").show(),$("#username").text(e.username)}$("#check").click(function(){$(this).attr("checked")?$(this).removeAttr("checked"):$(this).attr("checked","checked")}),$.ajax({url:"/login/username",type:"get",success:function(t){"logined"===t.signal?e(t):console.log("未登录")},error:function(){console.log("发生错误")}}),$("#loginbtn").click(function(e){e.preventDefault(),"登录"===$(this).text()&&$("#loginModal").modal({keyboard:!0})}),$("#loginSubmit").click(function(){var t=$("#user").val(),o=$("#password").val(),a=$("#check").attr("checked"),i=$(this);$.ajax({url:"/login",type:"POST",data:{username:t,password:o,checked:a},beforeSend:function(){i.attr("disabled","disabled").val("加载中...")},success:function(t){i.removeAttr("disabled").val("提交"),"success"===t.signal?($("#loginModal").modal("hide"),e(t)):($(".msg").show(),$("#user,#password").val(""))},error:function(){alert("发生错误")}})}),$("#out").click(function(){$.get("/login/out",function(e){"out"===e.signal&&(console.log("已退出"),$(".unLogin").show(),$(".logined").hide())})});var t={regForm:function(){$("#regModal").modal({keyboard:!0})},validate:function(){var e=$(".msg"),t=/^([a-z0-9]){6,}/i,o=/^([a-z0-9\_\-])+\@(([a-z0-9\_\-])+\.)+([a-z]{2,4})+$/i,a=/^1\d{10}$/;$("#regpassword").blur(function(){t.test($(this).val())?e.hide():(e.show().text("密码至少6位，只能是数字字母下划线"),$(this).focus())}),$("#email").blur(function(t){o.test($(this).val())?e.hide():(e.show().text("邮箱格式错误，正确的格式为:tom12@163.com"),$(this).focus())}),$("#phone").blur(function(){$(this).val()&&(a.test($(this).val())?(validated=1,e.hide()):(validated=0,$(this).focus(),e.show().text("手机号码格式错误,请填写11位手机号")))})},handleReg:function(){var e=$("#regname").val(),t=$("#trueName").val(),o=$("#regpassword").val(),a=$("#group").val(),i=$("#email").val(),n=$("#phone").val(),s=$(".msg");e&&t&&o&&a&&i?($("#regSubmit").removeAttr("disabled"),$.ajax({url:"/register",type:"POST",data:{username:e,trueName:t,password:o,group:a,email:i,phone:n},success:function(e){s.show(),"success"===e.signal?(s.text("提交成功，注册信息正在审核中..."),setTimeout(function(){$("#regModal").modal("hide")},1e3)):"用户名已存在"===e.signal?s.text("用户名被占用"):s.text("出错了！")},error:function(){console.log("请求错误")}})):($("#regSubmit").attr("disabled","disabled"),s.text("*为必填项,请填写完整信息"))}};$("#regbtn").click(t.regForm),t.validate(),$("#regSubmit").click(t.handleReg)});